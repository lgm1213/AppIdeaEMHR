<%# Safety Check: If f.object is nil, skip rendering to prevent crash %>
<% if f.object.present? %>
  <div class="nested-form-wrapper grid grid-cols-12 gap-3 items-end p-3 bg-gray-50 rounded border border-gray-200 mb-2" 
       data-new-record="<%= f.object.new_record? %>">
    
    <div class="col-span-10">
      <%= f.label :icd_code, "ICD-10 / Assessment", 
        class: "block text-xs font-bold text-gray-500 uppercase" 
      %>
      <%= f.text_field :icd_code, 
        class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm", 
        placeholder: "Type diagnosis (e.g. Cough, R05)",
        data: { action: "keydown->nested-form#stopEnter" }
      %>
    </div>

    <div class="col-span-2 text-right pb-1">
      <%= f.hidden_field :_destroy %>
      <button type="button" data-action="nested-form#remove" class="text-red-600 hover:text-red-900 text-sm font-medium">
        Remove
      </button>
    </div>
  </div>
<% end %>